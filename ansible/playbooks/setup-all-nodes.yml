---
# Master playbook for setting up all Raspberry Pi nodes
# This playbook runs on all nodes in the raspberry_pi group:
# - node-0 (control plane)
# - node-1 (worker)
#
# What it does:
# 1. System configuration (user, hostname, network, packages)
# 2. Terminal monitoring tools (btop, neofetch, tmux)
# 3. SSH key configuration
#
# Note: k3s installation is separate:
# - Control plane (node-0): use install-k3s.yml or setup-eldertree.yml
# - Worker nodes (node-1): use install-k3s-worker.yml

- name: System Configuration
  import_playbook: setup-system.yml
  vars:
    target_user: raolivei
    # Hostname defaults to inventory_hostname (node-0, node-1)
    # static_ip defaults to empty (DHCP) - override for nodes that need static IP
    # Example: ansible-playbook playbooks/setup-all-nodes.yml --limit node-0 -e static_ip=192.168.2.86

- name: Setup Terminal Monitoring
  import_playbook: setup-terminal-monitoring.yml
  vars:
    target_user: raolivei

- name: Configure SSH Keys
  import_playbook: configure-ssh-keys.yml
  vars:
    target_user: raolivei

- name: Setup Summary
  hosts: raspberry_pi
  tasks:
    - name: Display completion summary
      debug:
        msg:
          - "=== Setup Complete for {{ inventory_hostname }} ==="
          - "System packages: Installed"
          - "Terminal monitoring (btop, tmux, neofetch): Installed"
          - "SSH keys: Configured"
          - ""
          - "You can now SSH to {{ inventory_hostname }} and run 'btop' for monitoring"
          - ""
          - "Next steps:"
          - "  - For control plane (node-0): Run install-k3s.yml or setup-eldertree.yml"
          - "  - For worker nodes (node-1): Run install-k3s-worker.yml with k3s_token"

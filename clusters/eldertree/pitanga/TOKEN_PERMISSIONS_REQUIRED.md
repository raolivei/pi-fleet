# Required Token Permissions for Origin Certificates

## Current Issue

The new token still shows permission error (1016) when creating Origin Certificates.

## Required Permissions

When you created/rolled the token, make sure it has these **exact** permissions:

### Account-Level Permissions (Required)

- **Account** → **Cloudflare Tunnel** → **Edit** (for tunnels)
- **Account** → **SSL and Certificates** → **Edit** ✅ (for Origin Certificates)

### Zone-Level Permissions

- **Zone** → **Zone** → **Read**
- **Zone** → **DNS** → **Edit**
- **Zone** → **SSL and Certificates** → **Edit** ✅ (may also be needed)

### Resources

- **Account Resources**: Include "All accounts" (or your specific account)
- **Zone Resources**: Include `pitanga.cloud` (or "All zones")

## Important Notes

1. **Account-level SSL permission is often required** for Origin Certificates, not just Zone-level
2. The token must have access to the account that owns `pitanga.cloud`
3. Make sure the token wasn't created with only DNS permissions

## Verify Token Permissions

After updating the token, you can verify it works by testing the API:

```bash
# Test token
curl -s -X GET "https://api.cloudflare.com/client/v4/user/tokens/verify" \
  -H "Authorization: Bearer YOUR_TOKEN" | jq '.result'
```

## Next Steps

1. **Check token permissions in Cloudflare Dashboard:**

   - Go to: https://dash.cloudflare.com/profile/api-tokens
   - Find your token
   - Verify it has **Account** → **SSL and Certificates** → **Edit**

2. **If permissions are missing:**

   - Edit the token and add the missing permissions
   - Or create a new token with all required permissions

3. **Once permissions are correct:**
   - The token value should remain the same (unless you regenerated it)
   - Re-run Terraform with the same token

## Alternative: Manual Certificate Creation

If token permissions continue to be an issue, we can:

1. Use the CSR already generated by Terraform
2. Create the certificate manually in Cloudflare Dashboard
3. Store the certificate + private key in Vault

This is acceptable since Origin Certificates are long-lived (15 years).

apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: swimto-api-scaler
  namespace: swimto
spec:
  scaleTargetRef:
    name: swimto-api
  minReplicaCount: 0 # Scale to zero in standby
  maxReplicaCount: 5
  pollingInterval: 30
  cooldownPeriod: 300
  triggers:
    - type: prometheus
      metadata:
        serverAddress: http://prometheus-stack.observability.svc.cluster.local:80
        metricName: http_requests_per_second
        threshold: "5"
        query: |
          sum(rate(traefik_service_requests_total{
            service=~"swimto-swimto-api-service-8000@kubernetes"
          }[2m]))

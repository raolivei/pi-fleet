# Caddyfile for Eldertree Local Proxy
# Run with: sudo caddy run --config ~/WORKSPACE/raolivei/pi-fleet/scripts/Caddyfile
#
# This proxies *.eldertree.local to the k3s cluster via Traefik NodePort
# Allows accessing services without specifying port numbers
#
# Only includes DEPLOYED services (as of 2026-01-16)

{
    # Use local self-signed certs
    local_certs
}

# Grafana (observability)
grafana.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host grafana.eldertree.local
    }
}

# Vault (secrets management)
vault.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host vault.eldertree.local
    }
}

# Prometheus (metrics)
prometheus.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host prometheus.eldertree.local
    }
}

# Visage (photo management)
visage.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host visage.eldertree.local
    }
}

# MinIO (object storage for Visage)
minio.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host minio.eldertree.local
    }
}

# SwimTO (Toronto pool schedules)
swimto.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host swimto.eldertree.local
    }
}

# Pitanga (website)
pitanga.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host pitanga.eldertree.local
    }
}

# Flux UI (GitOps dashboard)
flux.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host flux.eldertree.local
    }
}

# Pushgateway (metrics push endpoint)
pushgateway.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host pushgateway.eldertree.local
    }
}

# Pi-hole (DNS admin - may not work via ingress)
pihole.eldertree.local {
    tls internal
    reverse_proxy https://192.168.2.101:32474 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up Host pihole.eldertree.local
    }
}
